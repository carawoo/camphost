---
id: TASK-73480f5
title: 캐싱 유틸리티 모듈 생성 (lib/cache.ts)
type: task
task_type: feat
status: DONE
priority: high
created: 2025-10-30T13:59:00Z
updated: 2025-10-30T14:02:47Z
assignee: scrum-master
epic: EPIC-8845599
dependencies: []
---

# TASK-73480f5: 캐싱 유틸리티 모듈 생성 (lib/cache.ts)

## Description

캠핑장 정보를 효율적으로 캐싱하기 위한 Smart Caching 유틸리티 모듈을 구현합니다. TTL(Time To Live) 기반 자동 만료 기능과 localStorage를 활용한 클라이언트 사이드 캐싱을 제공합니다.

## Requirements

- [x] CacheEntry<T> 인터페이스 정의 (data, timestamp, ttl)
- [x] CacheManager 클래스 구현
- [x] TTL 기반 자동 만료 기능
- [x] localStorage 기반 캐시 저장/조회
- [x] 에러 처리 (quota 초과, JSON parse 실패)
- [x] TypeScript 타입 안전성
- [x] 서버 사이드 안전 처리

## Tech Spec

### 설계 개요
- 구현 위치: `lib/cache.ts`
- 주요 기능: localStorage 기반 TTL 캐싱
- 타입 안전성: 제네릭 타입 활용

### 아키텍처
- **순수 TypeScript 유틸리티** (DI 패턴 불필요 - Next.js 클라이언트 유틸리티)
- localStorage API 사용
- 브라우저 환경 체크 (`typeof window === 'undefined'`)
- Graceful degradation (에러 발생 시 null 반환)

### 타입 정의

```typescript
interface CacheEntry<T> {
  data: T
  timestamp: number  // Date.now()
  ttl: number        // 밀리초
}
```

### CacheManager 클래스 API

```typescript
class CacheManager {
  // localStorage 키 접두사
  private prefix: string = 'camphost_cache_'

  // 캐시 저장
  set<T>(key: string, data: T, ttlMs: number): void

  // 캐시 조회 (만료 시 자동 삭제 후 null 반환)
  get<T>(key: string): T | null

  // 캐시 무효화
  invalidate(key: string): void

  // 모든 캐시 삭제
  clear(): void

  // 캐시 만료 여부 확인
  isExpired(key: string): boolean

  // 캐시 통계 (옵션)
  getStats(): { totalKeys: number, totalSize: number }
}
```

### 구현 세부사항

1. **서버 사이드 안전 처리**
   - 모든 메서드에서 `typeof window === 'undefined'` 체크
   - 서버 환경에서는 조기 반환 (null 또는 void)

2. **TTL 만료 로직**
   - `get()` 호출 시 `timestamp + ttl < Date.now()` 확인
   - 만료된 데이터는 `localStorage.removeItem()` 후 null 반환

3. **에러 처리**
   - localStorage quota 초과: try-catch로 graceful degradation
   - JSON.parse() 실패: catch 블록에서 null 반환
   - 모든 에러는 console.error로 로깅

4. **타입 안전성**
   - 제네릭 타입 `<T>` 사용
   - CacheEntry 타입으로 데이터 래핑
   - any 사용 금지

### 예상 사용 예시

```typescript
const cache = new CacheManager()

// 캐싱
const data = { name: 'Odoichon', address: '...' }
cache.set('campground_123', data, 300000) // 5분 TTL

// 조회
const cached = cache.get<CampgroundData>('campground_123')
if (cached) {
  console.log('Cache hit:', cached)
} else {
  console.log('Cache miss or expired')
}

// 무효화
cache.invalidate('campground_123')

// 통계
const stats = cache.getStats()
console.log('Total keys:', stats.totalKeys)
```

### 코딩 스타일
- Next.js 프로젝트 기존 스타일 준수
- 세미콜론 생략 (기존 lib 파일 스타일)
- 명확한 주석 작성
- console.error로 에러 로깅

## Work Log

### 2025-10-30 13:59 - scrum-master
- Task created

### 2025-10-30 22:58 - developer
- Tech Spec 작성 완료
- 구현 완료: lib/cache.ts
  - CacheEntry<T> 인터페이스 정의
  - CacheManager 클래스 구현
  - TTL 기반 자동 만료 기능
  - localStorage 기반 캐시 저장/조회/삭제
  - 에러 처리 (quota 초과, JSON parse 실패)
  - 서버 사이드 안전 처리 (typeof window 체크)
  - 캐시 통계 기능 (getStats)
  - 기본 캐시 매니저 인스턴스 export (cacheManager)
- 빌드: ✅ 성공 (next build)

## Status History

| Timestamp | Status | Agent | Note |
|-----------|--------|-------|------|
| 2025-10-30 13:59 | TODO | scrum-master | Task created |
| 2025-10-30 13:59 | IN_PROGRESS | scrum-master | Starting implementation |
| 2025-10-30 14:01 | READY_FOR_TEST | test-engineer | 구현 완료, 테스트 대기 |
| 2025-10-30 14:02 | DONE | scrum-master | 캐싱 유틸리티 모듈 구현 완료 (lib/cache.ts) |

## Artifacts

- Branch:
- Commit:
- Files Modified:

## Checklist

- [x] Tech spec written (Developer)
- [x] Code implemented (Developer)
- [x] Type check passed
- [x] Lint passed
- [x] Build succeeded
- [ ] Tests written (Test Engineer)
- [ ] Tests passed

