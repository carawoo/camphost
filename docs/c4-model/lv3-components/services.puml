@startuml CampHost Services Layer - Level 3 Components
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' ============================================================================
' CampHost - Services Layer (Level 3: Components)
' ============================================================================
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ:
'   - lib/ (ë ˆê±°ì‹œ í•¨ìˆ˜í˜• ì„œë¹„ìŠ¤)
'   - src/services/ (ì‹ ê·œ í´ë˜ìŠ¤ ê¸°ë°˜ ì„œë¹„ìŠ¤)
'   - src/utils/ (ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤)
'
' ì„œë¹„ìŠ¤ ë ˆì´ì–´ ì•„í‚¤í…ì²˜
' - ë°ì´í„° ê´€ë¦¬ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
' - localStorage ë° Supabase í†µí•©
' - ìœ í‹¸ë¦¬í‹° ë° í—¬í¼ í•¨ìˆ˜ ì œê³µ
'
' ============================================================================

LAYOUT_WITH_LEGEND()

title Services Layer - Component Diagram

' ============================================================================
' System Boundary
' ============================================================================

System_Boundary(services, "Services Layer") {

    ' ------------------------------------------------------------------------
    ' Legacy Services (lib/)
    ' ------------------------------------------------------------------------
    Container_Boundary(legacy_services, "Legacy Services (Functional)") {

        Component(reservation_service, "Reservation Service", "lib/reservations.ts", "ì˜ˆì•½ ë°ì´í„° ê´€ë¦¬\n\n**ì£¼ìš” ê¸°ëŠ¥:**\n- getReservations()\n- addReservation()\n- updateReservationStatus()\n- findReservation()\n\n**ì €ì¥ì†Œ:** localStorage\n**ì´ˆê¸° ë°ì´í„°:** ê¹€ì² ìˆ˜, ì´ì˜í¬ ì˜ˆì•½")

        Component(campground_info_service, "Campground Info Service", "lib/campground.ts", "ë‹¨ì¼ ìº í•‘ì¥ ì •ë³´ ê´€ë¦¬\n\n**ì£¼ìš” ê¸°ëŠ¥:**\n- getCampgroundInfo()\n- saveCampgroundInfo()\n- updateCampgroundInfo()\n\n**ì €ì¥ì†Œ:** localStorage\n**ê¸°ë³¸ê°’:** ì˜¤ë„ì´ì´Œ ìº í•‘ì¥")

        Component(campgrounds_management, "Campgrounds Management", "lib/campgrounds.ts", "ì „ì²´ ìº í•‘ì¥ ë° Super Admin ê´€ë¦¬\n\n**ì£¼ìš” ê¸°ëŠ¥:**\n- authenticateSuperAdmin()\n- getAllCampgrounds()\n- addCampground()\n- updateCampgroundStatus()\n- searchCampgrounds()\n\n**ì €ì¥ì†Œ:** localStorage\n**ì¸ì¦:** admin/admin123")
    }

    ' ------------------------------------------------------------------------
    ' Modern Services (src/services/)
    ' ------------------------------------------------------------------------
    Container_Boundary(modern_services, "Modern Services (Class-Based)") {

        Component(campground_service_class, "CampgroundService", "src/services/index.ts", "ìº í•‘ì¥ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤\n\n**êµ¬í˜„:** BaseService<Campground>\n**ì£¼ìš” ë©”ì„œë“œ:**\n- getAll() / getById()\n- create() / update() / delete()\n- getByStatus() / search()\n\n**ì˜ì¡´ì„±:** StorageManager\n**íŠ¹ì§•:** CRUD + ê²€ìƒ‰ + ìƒíƒœ ê´€ë¦¬")

        Component(reservation_service_class, "ReservationService", "src/services/index.ts", "ì˜ˆì•½ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤\n\n**êµ¬í˜„:** BaseService<Reservation>\n**ì£¼ìš” ë©”ì„œë“œ:**\n- getAll() / getById()\n- create() / update() / delete()\n- findByGuest()\n- getByCampground()\n\n**ì˜ì¡´ì„±:** StorageManager\n**íŠ¹ì§•:** CRUD + ê³ ê° ê²€ìƒ‰")

        Component(user_service, "UserService", "src/services/index.ts", "ì‚¬ìš©ì ì„¸ì…˜ ê´€ë¦¬\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- getCurrentUser()\n- setCurrentUser()\n- logout()\n- authenticateSuperAdmin()\n\n**ì˜ì¡´ì„±:** StorageManager\n**íŠ¹ì§•:** ì„¸ì…˜ ê´€ë¦¬ + Super Admin ì¸ì¦")

        Component(supabase_rest, "Supabase REST Helper", "src/services/supabaseRest.ts", "Supabase REST API í—¬í¼\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- select() / insert() / upsert()\n- update() / delete()\n\n**í†µí•©:** Supabase REST API\n**íŠ¹ì§•:** supabase-js ì—†ì´ ê²½ëŸ‰ êµ¬í˜„")
    }

    ' ------------------------------------------------------------------------
    ' Utilities (src/utils/)
    ' ------------------------------------------------------------------------
    Container_Boundary(utilities, "Utilities") {

        Component(storage_manager, "StorageManager", "src/utils/index.ts", "localStorage ê´€ë¦¬ ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- get<T>() / set<T>()\n- remove() / clear()\n- isClient()\n\n**íŠ¹ì§•:** SSR ëŒ€ì‘, ì—ëŸ¬ í•¸ë“¤ë§")

        Component(date_utils, "DateUtils", "src/utils/index.ts", "ë‚ ì§œ ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- formatDate() / getToday()\n- addDays() / isToday()\n\n**íŠ¹ì§•:** ISO í¬ë§·, í•œêµ­ì–´ í¬ë§·")

        Component(validation_utils, "ValidationUtils", "src/utils/index.ts", "í¼ ìœ íš¨ì„± ê²€ì‚¬\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- validateEmail() / validatePhone()\n- validateRequired()\n- validateForm()\n\n**íŠ¹ì§•:** íƒ€ì… ì•ˆì „ì„±")

        Component(string_utils, "StringUtils", "src/utils/index.ts", "ë¬¸ìì—´ ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- capitalize() / truncate()\n- slugify() / formatPhone()\n\n**íŠ¹ì§•:** í•œê¸€ ì§€ì›")

        Component(url_utils, "UrlUtils", "src/utils/index.ts", "URL ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- buildUrl() / getUrlParams()\n- getParam() / setParam()\n\n**íŠ¹ì§•:** Next.js ë¼ìš°íŒ… í˜¸í™˜")

        Component(error_handler, "ErrorHandler", "src/utils/index.ts", "ì—ëŸ¬ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- handle() / log()\n\n**íŠ¹ì§•:** íƒ€ì… ì•ˆì „ ì—ëŸ¬ ì²˜ë¦¬")

        Component(function_utils, "Function Utils", "src/utils/index.ts", "í•¨ìˆ˜í˜• ìœ í‹¸ë¦¬í‹°\n\n**ì£¼ìš” í•¨ìˆ˜:**\n- debounce() / throttle()\n\n**íŠ¹ì§•:** ì œë„¤ë¦­ íƒ€ì… ì§€ì›")
    }
}

' ============================================================================
' External Dependencies
' ============================================================================

ContainerDb(localStorage, "Browser Storage", "localStorage", "í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë°ì´í„° ì €ì¥")

System_Ext(supabase, "Supabase", "PostgreSQL ë°ì´í„°ë² ì´ìŠ¤\n\n**í…Œì´ë¸”:**\n- campgrounds\n- reservations")

' ============================================================================
' Relationships
' ============================================================================

' Legacy Services â†’ localStorage
Rel(reservation_service, localStorage, "read/write", "getReservations()\nsaveReservations()")
Rel(campground_info_service, localStorage, "read/write", "getCampgroundInfo()\nsaveCampgroundInfo()")
Rel(campgrounds_management, localStorage, "read/write", "getAllCampgrounds()\nsaveCampgrounds()")

' Modern Services â†’ StorageManager â†’ localStorage
Rel(campground_service_class, storage_manager, "uses", "CRUD operations")
Rel(reservation_service_class, storage_manager, "uses", "CRUD operations")
Rel(user_service, storage_manager, "uses", "session management")
Rel(storage_manager, localStorage, "manages", "get() / set() / remove()")

' Supabase REST Helper â†’ Supabase
Rel(supabase_rest, supabase, "REST API calls", "select() / insert()\nupdate() / delete()")

' Modern Services â†’ Supabase REST (ê°„ì ‘ ì‚¬ìš©)
Rel_Back(campground_service_class, supabase_rest, "sync (optional)", "UUID ë™ê¸°í™”")
Rel_Back(reservation_service_class, supabase_rest, "sync (optional)", "ë°ì´í„° ë™ê¸°í™”")

' Modern Services â†’ Utilities
Rel(campground_service_class, date_utils, "uses", "createdAt / updatedAt")
Rel(reservation_service_class, date_utils, "uses", "ë‚ ì§œ í¬ë§·")
Rel(user_service, validation_utils, "uses", "ì¸ì¦ ê²€ì¦")

' Services â†’ Error Handler
Rel(campground_service_class, error_handler, "uses", "ì—ëŸ¬ ë¡œê¹…")
Rel(reservation_service_class, error_handler, "uses", "ì—ëŸ¬ ë¡œê¹…")
Rel(storage_manager, error_handler, "uses", "localStorage ì˜¤ë¥˜ ì²˜ë¦¬")

' ============================================================================
' Notes
' ============================================================================

note right of legacy_services
  **Legacy Services (í•¨ìˆ˜í˜•)**

  íŠ¹ì§•:
  - í•¨ìˆ˜ ê¸°ë°˜ ì„¤ê³„ (Functional Programming)
  - SSR ëŒ€ì‘ (typeof window === 'undefined')
  - ì´ˆê¸° ìƒ˜í”Œ ë°ì´í„° ì œê³µ
  - ê°„ë‹¨í•œ CRUD ì‘ì—…

  ì‚¬ìš©ì²˜:
  - ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ (í˜¸í™˜ì„±)
  - ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘

  í•œê³„:
  - íƒ€ì… ì¼ê´€ì„± ë¶€ì¡±
  - DI íŒ¨í„´ ë¯¸ì§€ì›
  - í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€
end note

note right of modern_services
  **Modern Services (í´ë˜ìŠ¤ ê¸°ë°˜)**

  íŠ¹ì§•:
  - í´ë˜ìŠ¤ ê¸°ë°˜ ì„¤ê³„ (OOP)
  - BaseService ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
  - StorageManager ì˜ì¡´ì„± ì£¼ì…
  - íƒ€ì… ì•ˆì „ì„± ê°•í™”

  ì¥ì :
  - í…ŒìŠ¤íŠ¸ ìš©ì´ (Mocking)
  - í™•ì¥ì„± (ìƒì†, ì¸í„°í˜ì´ìŠ¤)
  - ì¼ê´€ëœ API

  ë§ˆì´ê·¸ë ˆì´ì…˜:
  - lib/ â†’ src/services/ ì ì§„ì  ì „í™˜
  - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ (Breaking Change ë°©ì§€)
end note

note right of utilities
  **Utilities (ê³µìš© í—¬í¼)**

  íŠ¹ì§•:
  - ì •ì  ë©”ì„œë“œ (Static Methods)
  - ì¬ì‚¬ìš© ê°€ëŠ¥
  - í”„ë ˆì„ì›Œí¬ ë…ë¦½ì 

  ì‚¬ìš©ì²˜:
  - Services
  - Components
  - Hooks

  í™•ì¥:
  - í•„ìš”ì‹œ ìƒˆ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ ì¶”ê°€
end note

' ============================================================================
' ë™ê¸°í™” ì²´í¬ë¦¬ìŠ¤íŠ¸
' ============================================================================
'
' â–¡ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ì¶”ê°€ ì‹œ
'   - Component(...) ì¶”ê°€
'   - Rel(...) ì˜ì¡´ì„± ê´€ê³„ ì •ì˜
'   - Noteì— ì„¤ëª… ì¶”ê°€
'
' â–¡ ì„œë¹„ìŠ¤ ë©”ì„œë“œ ë³€ê²½ ì‹œ
'   - Component ì„¤ëª… ì—…ë°ì´íŠ¸
'   - Level 4 (lv4-code/services/*.puml) ë™ê¸°í™”
'
' â–¡ ìœ í‹¸ë¦¬í‹° ì¶”ê°€ ì‹œ
'   - Component(...) ì¶”ê°€
'   - ì‚¬ìš© ê´€ê³„ ì •ì˜
'
' â–¡ ì™¸ë¶€ ì‹œìŠ¤í…œ í†µí•© ì‹œ
'   - System_Ext(...) ì¶”ê°€
'   - Rel(...) í†µì‹  ê´€ê³„ ì •ì˜
'
' ============================================================================

legend right
  **Level 3: Components - Services Layer**

  **ì•„í‚¤í…ì²˜ íŒ¨í„´**:
  - Legacy (Functional) + Modern (Class-Based) ê³µì¡´
  - ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ (lib/ â†’ src/services/)
  - ìœ í‹¸ë¦¬í‹° ê³µìš©í™” (src/utils/)

  **ë°ì´í„° íë¦„**:
  1. **ì½ê¸°**: Component â†’ Service â†’ StorageManager â†’ localStorage
  2. **ì“°ê¸°**: Component â†’ Service â†’ StorageManager â†’ localStorage
  3. **ë™ê¸°í™”** (ì„ íƒ): Service â†’ Supabase REST â†’ Supabase DB

  **ë ˆì´ì–´ ì±…ì„**:
  - **Services**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, CRUD, ë°ì´í„° ë³€í™˜
  - **Utilities**: ê³µìš© í—¬í¼, í¬ë§·, ê²€ì¦, ì—ëŸ¬ ì²˜ë¦¬
  - **StorageManager**: localStorage ì¶”ìƒí™”, SSR ëŒ€ì‘

  **ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ**:
  - ì‹ ê·œ ê¸°ëŠ¥: src/services/ ì‚¬ìš©
  - ê¸°ì¡´ ê¸°ëŠ¥: lib/ ìœ ì§€ (ì ì§„ì  ì „í™˜)
  - ê³µìš© ë¡œì§: src/utils/ ì¶”ì¶œ

  **Next.js í†µí•©**:
  - SSR ëŒ€ì‘: typeof window ì²´í¬
  - App Router í˜¸í™˜
  - Client Componentì—ì„œ ì‚¬ìš©

  **íƒ€ì… ì •ì˜**:
  - src/types/: ë„ë©”ì¸ ëª¨ë¸ íƒ€ì…
  - src/constants/: ì„¤ì • ë° ì´ˆê¸° ë°ì´í„°

  **í…ŒìŠ¤íŠ¸ ì „ëµ**:
  - Legacy: í†µí•© í…ŒìŠ¤íŠ¸ ìœ„ì£¼
  - Modern: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ + Mocking
  - Utilities: ë…ë¦½ì  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

  **ì„±ëŠ¥ ìµœì í™”**:
  - debounce/throttle (ê²€ìƒ‰, ìë™ì €ì¥)
  - localStorage ìºì‹±
  - Lazy Loading (í•„ìš” ì‹œ)

  **í–¥í›„ ê³„íš**:
  - [ ] lib/ ì™„ì „ ë§ˆì´ê·¸ë ˆì´ì…˜
  - [ ] Supabase ìš°ì„  ì „ëµ (localStorage fallback)
  - [ ] Service Worker (ì˜¤í”„ë¼ì¸ ì§€ì›)
  - [ ] IndexedDB (ëŒ€ìš©ëŸ‰ ë°ì´í„°)
end legend

@enduml
