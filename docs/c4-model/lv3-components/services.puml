@startuml CampHost Services Component Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' ============================================================================
' Level 3: Component Diagram - Services Layer
' ============================================================================
'
' Web Application ë‚´ë¶€ì˜ ì£¼ìš” ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.
' - CacheManager (lib/cache.ts)
' - CampgroundService (lib/campground.ts)
' - SupabaseRest (src/services/supabaseRest.ts)
'
' ğŸ”— ì´ì „ ë ˆë²¨: lv2-containers/overview.puml
' ============================================================================

LAYOUT_WITH_LEGEND()

title Component Diagram for CampHost - Services Layer

' ============================================================================
' Container Boundary
' ============================================================================

Container_Boundary(services, "Services Layer") {

    ' ------------------------------------------------------------------------
    ' CacheManager (NEW)
    ' ------------------------------------------------------------------------
    Component(cacheManager, "CacheManager", "TypeScript Class", "TTL ê¸°ë°˜ ìºì‹± ê´€ë¦¬ì\n\n**ì£¼ìš” ë©”ì„œë“œ:**\n- set<T>(key, data, ttl)\n- get<T>(key): T | null\n- invalidate(key)\n- clear()\n- getStats()\n\n**TTL:** 5ë¶„ (300000ms)\n**Storage:** localStorage")

    ' ------------------------------------------------------------------------
    ' CampgroundService
    ' ------------------------------------------------------------------------
    Component(campgroundService, "CampgroundService", "TypeScript Service", "ìº í•‘ì¥ ë°ì´í„° ê´€ë¦¬\n\n**ë©”ì„œë“œ:**\n- getAll()\n- getById(id)\n- update(id, data)")

    ' ------------------------------------------------------------------------
    ' SupabaseRest
    ' ------------------------------------------------------------------------
    Component(supabaseRest, "SupabaseRest", "REST API Client", "Supabase REST API í´ë¼ì´ì–¸íŠ¸\n\n**ë©”ì„œë“œ:**\n- select<T>(table, query)\n- insert(table, data)\n- update(table, data, filter)\n- delete(table, filter)")

}

' ============================================================================
' External Dependencies
' ============================================================================

ContainerDb(localStorage, "Browser Storage", "localStorage", "Key-Value ì €ì¥ì†Œ")

System_Ext(supabase, "Supabase", "PostgreSQL Database")

' ============================================================================
' Relationships
' ============================================================================

' CacheManager â†’ localStorage
Rel(cacheManager, localStorage, "ì €ì¥/ì¡°íšŒ", "setItem() / getItem()\nJSON.stringify / parse")

' Admin Settings â†’ CacheManager
Rel_U(cacheManager, campgroundService, "ìºì‹± ë ˆì´ì–´", "Cache-First ì „ëµ")

' CampgroundService â†’ SupabaseRest
Rel(campgroundService, supabaseRest, "ë°ì´í„° ì¡°íšŒ/ìˆ˜ì •", "select() / update()")

' SupabaseRest â†’ Supabase
Rel(supabaseRest, supabase, "REST API", "HTTPS / JSON")

' ============================================================================
' Notes
' ============================================================================

note right of cacheManager
  **Smart Caching ì „ëµ:**
  1. Cache-First ì „ëµ
  2. TTL ê¸°ë°˜ ìë™ ë§Œë£Œ (5ë¶„)
  3. Stale-While-Revalidate
  4. ì €ì¥ ì‹œ ìë™ ê°±ì‹ 

  **ì„±ëŠ¥ í–¥ìƒ:**
  - ì²« ë°©ë¬¸: ~500ms (Supabase)
  - ì¬ë°©ë¬¸: ~10ms (Cache)
  - 40-80ë°° ì†ë„ í–¥ìƒ

  **ì‚¬ìš© ìœ„ì¹˜:**
  - app/admin/settings/page.tsx
  - app/kiosk/page.tsx
end note

' ============================================================================
' ë™ê¸°í™” ì²´í¬ë¦¬ìŠ¤íŠ¸
' ============================================================================
'
' â–¡ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ì¶”ê°€ ì‹œ
'   - Component(...) ì¶”ê°€
'   - Rel(...) ê´€ê³„ ì •ì˜
'
' â–¡ ìºì‹± ì „ëµ ë³€ê²½ ì‹œ
'   - cacheManager Note ì—…ë°ì´íŠ¸
'
' â–¡ TTL ë³€ê²½ ì‹œ
'   - cacheManager ì„¤ëª… ì—…ë°ì´íŠ¸
'
@enduml
