@startuml
' ==============================================================================
' [Level 2] Container - API Monorepo
' ==============================================================================
' Project: @pioncorp/api-monorepo-starter
' Description: Monorepo ë‚´ë¶€ì˜ Appsì™€ Packages (Containers)
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ:
'    â€¢ apps/* - ì‹¤í–‰ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜
'    â€¢ packages/* - ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬/ë„ë©”ì¸
'
' ğŸ”„ ë™ê¸°í™” ê·œì¹™:
'    âœ… lv1 (system.puml) - ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²° í™•ì¸
'    âœ… lv3 (sample-domain.puml) ë³€ê²½ ì‹œ ì´ ë‹¤ì´ì–´ê·¸ë¨ í™•ì¸ í•„ìš”
'    âœ… ìƒˆë¡œìš´ íŒ¨í‚¤ì§€/ì•± ì¶”ê°€ ì‹œ ì´ ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸
'
' ğŸ“ ë³€ê²½ ëŒ€ìƒ:
'    â€¢ Container - Apps/Packages ì¶”ê°€/ì œê±°
'    â€¢ Rel - íŒ¨í‚¤ì§€ ê°„ ì˜ì¡´ì„± ë³€ê²½
'    â€¢ External Services ì—°ê²°
'
' ğŸ” ë“œë¦´ë‹¤ìš´:
'    â€¢ sample-domain â†’ ../lv3-components/sample-domain.puml
'    â€¢ (hono-api, shared-core, shared-configëŠ” Level 3 ì—†ìŒ - ë‹¨ìˆœ êµ¬ì¡°)
'
' â¬†ï¸  Zoom Out: ../lv1-system-context/system.puml
' ==============================================================================

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title [Level 2] Container - API Monorepo

Person(end_user, "End User", "API ì‚¬ìš©ì")
Person(developer, "Developer", "ê°œë°œì")

System_Boundary(monorepo, "API Monorepo") {

    ' ========== Apps ==========
    Container_Boundary(apps, "Applications") {
        Container(hono_api, "Hono API", "Hono.js / TypeScript", "HTTP REST API Server\n- Routes & Controllers\n- Middleware\n- Error Handling")
    }

    ' ========== Packages (Domain) ==========
    Container_Boundary(domain_packages, "Domain Packages") {
        Container(sample_domain, "sample-domain", "@pioncorp/sample-domain", "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§\n- UserService\n- NotificationService\n- Strategy Pattern")
    }

    ' ========== Packages (Shared) ==========
    Container_Boundary(shared_packages, "Shared Packages") {
        Container(shared_core, "shared-core", "@pioncorp/shared-core", "ê³µí†µ ìœ í‹¸ë¦¬í‹°\n- Logger\n- DI Container Setup\n- Common Types")

        Container(shared_config, "shared-config", "@pioncorp/shared-config", "ê³µí†µ ì„¤ì •\n- TypeScript Config\n- ESLint Config\n- Vitest Config")
    }
}

' External Systems
System_Ext(email_service, "Email Service", "AWS SES / SendGrid")
System_Ext(sms_service, "SMS Service", "Twilio")
System_Ext(push_service, "Push Service", "Firebase FCM")
System_Ext(kakao_service, "Kakao Service", "Kakao Talk API")

' User to Apps
Rel(end_user, hono_api, "HTTP ìš”ì²­", "REST/JSON")
Rel(developer, hono_api, "ê°œë°œ/í…ŒìŠ¤íŠ¸", "Local Dev Server")

' Apps to Packages
Rel(hono_api, sample_domain, "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í˜¸ì¶œ", "Function Call")
Rel(hono_api, shared_core, "ë¡œê¹…/ìœ í‹¸ ì‚¬ìš©", "Import")

' Domain to Shared
Rel(sample_domain, shared_core, "ë¡œê¹…/DI ì‚¬ìš©", "Import")

' Shared Config (Build Time)
Rel_Back(hono_api, shared_config, "ë¹Œë“œ ì„¤ì •", "extends")
Rel_Back(sample_domain, shared_config, "ë¹Œë“œ ì„¤ì •", "extends")
Rel_Back(shared_core, shared_config, "ë¹Œë“œ ì„¤ì •", "extends")

' Domain to External Services
Rel(sample_domain, email_service, "ì´ë©”ì¼ ë°œì†¡", "HTTPS/API")
Rel(sample_domain, sms_service, "SMS ë°œì†¡", "HTTPS/API")
Rel(sample_domain, push_service, "í‘¸ì‹œ ë°œì†¡", "HTTPS/API")
Rel(sample_domain, kakao_service, "ì•Œë¦¼í†¡ ë°œì†¡", "HTTPS/API")

SHOW_LEGEND()

note right of monorepo
  <b>Monorepo êµ¬ì¡°</b>
  â€¢ apps/* - ì‹¤í–‰ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜
  â€¢ packages/* - ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬

  <b>ë¹Œë“œ ì‹œìŠ¤í…œ</b>
  â€¢ Turborepo - íƒœìŠ¤í¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
  â€¢ Yarn Workspaces - íŒ¨í‚¤ì§€ ê´€ë¦¬
  â€¢ Changesets - ë²„ì „ ê´€ë¦¬
end note

note bottom of sample_domain
  <b>ğŸ” Drill Down</b>
  ì´ ì»¨í…Œì´ë„ˆì˜ ë‚´ë¶€ êµ¬ì¡°:
  â†’ ../lv3-components/sample-domain.puml

  <b>ì£¼ìš” ì»´í¬ë„ŒíŠ¸</b>
  â€¢ UserService
  â€¢ NotificationService
  â€¢ Provider Strategy
end note

note as SyncGuide #FFE0E0
  <b>âš ï¸  ë™ê¸°í™” ì²´í¬ë¦¬ìŠ¤íŠ¸</b>
  ====
  ì´ ë‹¤ì´ì–´ê·¸ë¨ ë³€ê²½ ì‹œ:

  â˜ ìƒˆë¡œìš´ íŒ¨í‚¤ì§€/ì•± ì¶”ê°€?
     â†’ Container ì¶”ê°€
     â†’ Rel ì˜ì¡´ì„± ì¶”ê°€
     â†’ lv1ì—ì„œ ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²° í™•ì¸

  â˜ lv3 (sample-domain.puml) ë³€ê²½ ì‹œ
     ì´ ë‹¤ì´ì–´ê·¸ë¨ì˜ ì„¤ëª… ì—…ë°ì´íŠ¸

  â˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¶”ê°€/ì œê±° ì‹œ
     â†’ lv1 (system.puml) ë™ê¸°í™”
     â†’ sample_domain â†’ ì™¸ë¶€ ì„œë¹„ìŠ¤ Rel ì¶”ê°€
end note

@enduml
