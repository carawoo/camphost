@startuml Notification Service - Level 4 Code
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' ============================================================================
' CampHost - Notification Service (Level 4: Code)
' ============================================================================
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ: app/api/notify/checkin/route.ts
'
' ì²´í¬ì¸ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì„œë¹„ìŠ¤
' - Next.js API Route
' - Resend ì´ë©”ì¼ ì„œë¹„ìŠ¤ í†µí•©
' - í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
'
' ============================================================================

title Notification Service - Code Level

' API Request/Response íƒ€ì…
class CheckinNotificationRequest {
  + campgroundName: string
  + guestName: string
  + phone: string
  + roomNumber: string
  + checkInDate: string
  + checkOutDate: string
  + guests: number
  + amount: number
  + contactPhone: string
  + contactEmail: string
}

note right of CheckinNotificationRequest
  ì²´í¬ì¸ ì•Œë¦¼ ìš”ì²­ ë°ì´í„°
  - campgroundName: ìº í•‘ì¥ ì´ë¦„
  - guestName: ê³ ê°ëª…
  - phone: ì—°ë½ì²˜
  - roomNumber: ê°ì‹¤ ë²ˆí˜¸
  - checkInDate/checkOutDate: ì²´í¬ì¸/ì•„ì›ƒ ë‚ ì§œ
  - guests: ì¸ì› ìˆ˜
  - amount: ê²°ì œ ê¸ˆì•¡
  - contactPhone/contactEmail: ìº í•‘ì¥ ì‚¬ì¥ë‹˜ ì—°ë½ì²˜
end note

class NotificationResponse {
  + ok: boolean
  + error?: string
}

note right of NotificationResponse
  API ì‘ë‹µ íƒ€ì…
  - ok: ì„±ê³µ ì—¬ë¶€
  - error: ì—ëŸ¬ ë©”ì‹œì§€ (ì‹¤íŒ¨ ì‹œ)
end note

' API Route Handler
package "Next.js API Route" {
  class CheckinNotificationRoute <<API Route>> {
    + {static} POST(request: Request): Promise<NextResponse>
    --
    - parseRequestBody(request: Request): Promise<CheckinNotificationRequest>
    - validateEnvironment(): string | null
    - buildEmailContent(data: CheckinNotificationRequest): { subject: string, text: string }
    - sendEmail(resend: Resend, to: string, subject: string, text: string): Promise<void>
  }
}

note bottom of CheckinNotificationRoute
  **POST /api/notify/checkin**

  **ì²˜ë¦¬ íë¦„**:
  1. Request Body íŒŒì‹± (JSON)
  2. í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ (RESEND_API_KEY)
  3. Resend í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
  4. ì´ë©”ì¼ ìˆ˜ì‹ ì ê²°ì • (NOTIFY_EMAIL ë˜ëŠ” ê¸°ë³¸ê°’)
  5. ì´ë©”ì¼ ì œëª© ë° ë³¸ë¬¸ êµ¬ì„±
  6. Resend API í˜¸ì¶œ (ì´ë©”ì¼ ë°œì†¡)
  7. ì‘ë‹µ ë°˜í™˜ (ì„±ê³µ/ì‹¤íŒ¨)

  **í™˜ê²½ ë³€ìˆ˜**:
  - RESEND_API_KEY: Resend API í‚¤ (í•„ìˆ˜)
  - NOTIFY_EMAIL: ì•Œë¦¼ ìˆ˜ì‹  ì´ë©”ì¼ (ì„ íƒ, ê¸°ë³¸ê°’: odoichon@odoichon.com)

  **ì—ëŸ¬ ì²˜ë¦¬**:
  - RESEND_API_KEY ë¯¸ì„¤ì •: 500 ì—ëŸ¬
  - ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: 500 ì—ëŸ¬ (error.message í¬í•¨)
end note

' Resend SDK
package "Resend SDK" {
  class Resend {
    + constructor(apiKey: string)
    + emails: EmailsAPI
  }

  class EmailsAPI {
    + send(params: EmailParams): Promise<EmailResponse>
  }

  class EmailParams {
    + from: string
    + to: string
    + subject: string
    + text: string
  }

  class EmailResponse {
    + id: string
  }
}

note bottom of Resend
  **Resend ì´ë©”ì¼ ì„œë¹„ìŠ¤**
  - npm: resend
  - ê³µì‹ ë¬¸ì„œ: https://resend.com/docs

  **ë°œì‹ ì**: Odoichon <no-reply@odoichon.com>
  **ìˆ˜ì‹ ì**: NOTIFY_EMAIL í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’
end note

' í™˜ê²½ ë³€ìˆ˜
class EnvironmentVariables <<config>> {
  + {static} RESEND_API_KEY: string
  + {static} NOTIFY_EMAIL?: string
}

note right of EnvironmentVariables
  **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (.env.local)

  RESEND_API_KEY=re_xxxxxxxxxxxx
  NOTIFY_EMAIL=admin@example.com

  âš ï¸ RESEND_API_KEYëŠ” í•„ìˆ˜
end note

' Next.js Framework
class NextResponse <<framework>> {
  + {static} json(data: any, options?: ResponseInit): NextResponse
}

note right of NextResponse
  Next.js API Response í—¬í¼
  - ìƒíƒœ ì½”ë“œ: 200 (ì„±ê³µ), 500 (ì—ëŸ¬)
end note

' ê´€ê³„
CheckinNotificationRoute --> CheckinNotificationRequest : parses
CheckinNotificationRoute --> NotificationResponse : returns
CheckinNotificationRoute --> Resend : uses
CheckinNotificationRoute --> EnvironmentVariables : reads
CheckinNotificationRoute --> NextResponse : uses

Resend --> EmailsAPI : contains
EmailsAPI --> EmailParams : accepts
EmailsAPI --> EmailResponse : returns

' ë ˆì´ì•„ì›ƒ
CheckinNotificationRequest -[hidden]down- CheckinNotificationRoute
NotificationResponse -[hidden]down- CheckinNotificationRoute

legend right
  **Level 4: Code - Notification Service**

  **íŒŒì¼**: app/api/notify/checkin/route.ts
  **íƒ€ì…**: Next.js API Route (Server-Side)
  **í†µí•©**: Resend ì´ë©”ì¼ ì„œë¹„ìŠ¤

  **íŠ¹ì§•**:
  - Next.js 14.2 App Router ê¸°ë°˜
  - POST ë©”ì„œë“œë§Œ ì§€ì›
  - ë¹„ë™ê¸° ì´ë©”ì¼ ë°œì†¡ (async/await)
  - í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
  - ì—ëŸ¬ í•¸ë“¤ë§ (try-catch)

  **ì´ë©”ì¼ í˜•ì‹** (Plain Text):
  ```
  ì œëª©: ì²´í¬ì¸ ì•Œë¦¼ - {ìº í•‘ì¥ëª…}

  ë³¸ë¬¸:
  ìº í•‘ì¥: {campgroundName}
  ê³ ê°ëª…: {guestName}
  ì—°ë½ì²˜: {phone}
  ê°ì‹¤: {roomNumber}
  ì²´í¬ì¸/ì•„ì›ƒ: {checkInDate} ~ {checkOutDate}
  ì¸ì›: {guests}
  ê¸ˆì•¡: {amount}ì›

  ë¬¸ì˜(ì‚¬ì¥ë‹˜): {contactPhone} / {contactEmail}
  ```

  **ì‚¬ìš© ì˜ˆì‹œ**:
  ```typescript
  // Client-side fetch í˜¸ì¶œ
  const response = await fetch('/api/notify/checkin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      campgroundName: 'ì˜¤ë„ì´ì´Œ ìº í•‘ì¥',
      guestName: 'ê¹€ì² ìˆ˜',
      phone: '010-1234-5678',
      roomNumber: 'Aë™-101',
      checkInDate: '2025-01-30',
      checkOutDate: '2025-02-01',
      guests: 4,
      amount: 150000,
      contactPhone: '010-1234-5678',
      contactEmail: 'carawoo96@gmail.com'
    })
  })

  const result = await response.json()
  // { ok: true } or { error: '...' }
  ```

  **Resend ì„¤ì •**:
  1. Resend ê³„ì • ìƒì„±: https://resend.com
  2. API Key ë°œê¸‰
  3. .env.localì— RESEND_API_KEY ì¶”ê°€
  4. ë°œì‹  ë„ë©”ì¸ ê²€ì¦ (ì„ íƒ)
end legend

@enduml
