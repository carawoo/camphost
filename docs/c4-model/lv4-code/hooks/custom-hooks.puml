@startuml Custom Hooks - Level 4 Code
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' ============================================================================
' CampHost - Custom Hooks (Level 4: Code)
' ============================================================================
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ: src/hooks/index.ts
'
' React Custom Hooks ì»¬ë ‰ì…˜
' - ìº í•‘ì¥ ê´€ë¦¬ (useCampgrounds)
' - ì˜ˆì•½ ê´€ë¦¬ (useReservations)
' - ì‚¬ìš©ì ì¸ì¦ (useAuth)
' - í¼ ê´€ë¦¬ (useForm)
' - í•„í„°ë§/ê²€ìƒ‰ (useFilteredData)
' - ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ (useLocalStorage)
'
' ============================================================================

title Custom Hooks - Code Level

' ============================================================================
' 1. useCampgrounds Hook
' ============================================================================
class useCampgrounds <<hook>> {
  ' State
  - campgrounds: Campground[]
  - isLoading: boolean
  - error: string | null

  ' Methods
  + loadCampgrounds(): void
  + addCampground(data: Omit<Campground, 'id' | 'createdAt' | 'updatedAt'>): Campground
  + updateCampground(id: string, data: Partial<Campground>): Campground | null
  + deleteCampground(id: string): boolean
  + refetch(): void

  ' Return
  --
  Returns: {
    campgrounds,
    isLoading,
    error,
    addCampground,
    updateCampground,
    deleteCampground,
    refetch
  }
}

note right of useCampgrounds
  **ìº í•‘ì¥ ë°ì´í„° ê´€ë¦¬ í›…**

  - useStateë¡œ ìƒíƒœ ê´€ë¦¬
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - useEffectë¡œ ì´ˆê¸° ë¡œë“œ
  - campgroundServiceì™€ ì—°ë™

  **ì—ëŸ¬ ì²˜ë¦¬**:
  - ê° ì‘ì—… ì‹¤íŒ¨ ì‹œ error ìƒíƒœ ì—…ë°ì´íŠ¸
  - throwë¡œ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì— ì „íŒŒ
end note

' ============================================================================
' 2. useReservations Hook
' ============================================================================
class useReservations <<hook>> {
  ' State
  - reservations: Reservation[]
  - isLoading: boolean
  - error: string | null

  ' Methods
  + loadReservations(): void
  + addReservation(data: Omit<Reservation, 'id' | 'createdAt' | 'updatedAt'>): Reservation
  + updateReservation(id: string, data: Partial<Reservation>): Reservation | null
  + deleteReservation(id: string): boolean
  + refetch(): void

  ' Return
  --
  Returns: {
    reservations,
    isLoading,
    error,
    addReservation,
    updateReservation,
    deleteReservation,
    refetch
  }
}

note right of useReservations
  **ì˜ˆì•½ ë°ì´í„° ê´€ë¦¬ í›…**

  - useStateë¡œ ìƒíƒœ ê´€ë¦¬
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - useEffectë¡œ ì´ˆê¸° ë¡œë“œ
  - reservationServiceì™€ ì—°ë™

  **ì—ëŸ¬ ì²˜ë¦¬**:
  - ê° ì‘ì—… ì‹¤íŒ¨ ì‹œ error ìƒíƒœ ì—…ë°ì´íŠ¸
  - throwë¡œ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì— ì „íŒŒ
end note

' ============================================================================
' 3. useAuth Hook
' ============================================================================
class useAuth <<hook>> {
  ' State
  - user: User | null
  - isLoading: boolean

  ' Methods
  + loadUser(): void
  + login(username: string, password: string): boolean
  + logout(): void

  ' Return
  --
  Returns: {
    user,
    isLoading,
    login,
    logout,
    isAuthenticated: boolean
  }
}

note right of useAuth
  **ì‚¬ìš©ì ì¸ì¦ ê´€ë¦¬ í›…**

  - useStateë¡œ ìƒíƒœ ê´€ë¦¬
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - useEffectë¡œ ì´ˆê¸° ì‚¬ìš©ì ë¡œë“œ
  - userServiceì™€ ì—°ë™

  **íŠ¹ì§•**:
  - isAuthenticated: computed ê°’ (!!user)
  - Super Admin ì¸ì¦ ì§€ì›
end note

' ============================================================================
' 4. useForm Hook (Generic)
' ============================================================================
class useForm <<hook>> {
  ' Parameters
  + <T extends Record<string, any>>
  + initialData: T
  + validationRules?: Partial<Record<keyof T, (value: any) => boolean>>

  ' State
  - formState: FormState<T>
    - data: T
    - errors: Partial<Record<keyof T, string>>
    - isSubmitting: boolean
    - isValid: boolean

  ' Methods
  + updateField(field: keyof T, value: any): void
  + validateForm(): boolean
  + resetForm(): void
  + setSubmitting(isSubmitting: boolean): void

  ' Return
  --
  Returns: {
    formState,
    updateField,
    validateForm,
    resetForm,
    setSubmitting
  }
}

note right of useForm
  **ì œë„¤ë¦­ í¼ ê´€ë¦¬ í›…**

  - Generic íƒ€ì… <T>ë¡œ ìœ ì—°ì„± ì œê³µ
  - useStateë¡œ í¼ ìƒíƒœ ê´€ë¦¬
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - ValidationUtilsì™€ ì—°ë™

  **ê¸°ëŠ¥**:
  - í•„ë“œë³„ ì—ëŸ¬ ê´€ë¦¬
  - ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì¦
  - ì œì¶œ ìƒíƒœ ê´€ë¦¬
  - í¼ ì´ˆê¸°í™”

  **ì‚¬ìš© ì˜ˆì‹œ**:
  ```typescript
  const { formState, updateField, validateForm } =
    useForm({ name: '', email: '' }, {
      name: (v) => v.length > 0,
      email: (v) => /\S+@\S+/.test(v)
    })
  ```
end note

' ============================================================================
' 5. useFilteredData Hook (Generic)
' ============================================================================
class useFilteredData <<hook>> {
  ' Parameters
  + <T>
  + data: T[]
  + filterFn: (item: T, filters: FilterOptions) => boolean

  ' State
  - filters: FilterOptions

  ' Computed
  - filteredData: T[]

  ' Methods
  + updateFilter(key: keyof FilterOptions, value: any): void
  + clearFilters(): void

  ' Return
  --
  Returns: {
    filteredData,
    filters,
    updateFilter,
    clearFilters
  }
}

note right of useFilteredData
  **í•„í„°ë§ ë° ê²€ìƒ‰ ê´€ë¦¬ í›…**

  - Generic íƒ€ì… <T>ë¡œ ìœ ì—°ì„± ì œê³µ
  - useStateë¡œ í•„í„° ìƒíƒœ ê´€ë¦¬
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - ì»¤ìŠ¤í…€ filterFnìœ¼ë¡œ í•„í„°ë§ ë¡œì§ ì£¼ì…

  **íŠ¹ì§•**:
  - í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§
  - computed ê°’ìœ¼ë¡œ filteredData ì œê³µ
  - í•„í„° ì´ˆê¸°í™” ì§€ì›

  **ì‚¬ìš© ì˜ˆì‹œ**:
  ```typescript
  const { filteredData, updateFilter } =
    useFilteredData(
      campgrounds,
      (item, filters) =>
        !filters.search ||
        item.name.includes(filters.search)
    )
  ```
end note

' ============================================================================
' 6. useLocalStorage Hook (Generic)
' ============================================================================
class useLocalStorage <<hook>> {
  ' Parameters
  + <T>
  + key: string
  + initialValue: T

  ' State
  - storedValue: T

  ' Methods
  + setValue(value: T | ((val: T) => T)): void

  ' Return
  --
  Returns: [storedValue, setValue]
}

note right of useLocalStorage
  **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë™ê¸°í™” í›…**

  - Generic íƒ€ì… <T>ë¡œ ìœ ì—°ì„± ì œê³µ
  - useStateë¡œ ìƒíƒœ ê´€ë¦¬ (lazy initialization)
  - useCallbackë¡œ ë©”ëª¨ì´ì œì´ì…˜
  - localStorageì™€ ìë™ ë™ê¸°í™”

  **íŠ¹ì§•**:
  - SSR ëŒ€ì‘ (typeof window === 'undefined')
  - JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”
  - í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ ì§€ì›
  - ì—ëŸ¬ ì²˜ë¦¬ (try-catch)

  **ì‚¬ìš© ì˜ˆì‹œ**:
  ```typescript
  const [user, setUser] =
    useLocalStorage<User | null>('user', null)
  ```
end note

' ============================================================================
' ì™¸ë¶€ ì˜ì¡´ì„±
' ============================================================================
package "React" {
  class ReactHooks <<library>> {
    + useState()
    + useEffect()
    + useCallback()
  }
}

package "Services" {
  class CampgroundService {
    + getAll()
    + create()
    + update()
    + delete()
  }

  class ReservationService {
    + getAll()
    + create()
    + update()
    + delete()
  }

  class UserService {
    + getCurrentUser()
    + authenticateSuperAdmin()
    + logout()
  }
}

package "Utils" {
  class ValidationUtils {
    + validateForm()
  }
}

database localStorage {
  frame "Browser Storage" {
    [key-value pairs]
  }
}

' ============================================================================
' íƒ€ì… ì˜ì¡´ì„±
' ============================================================================
package "Types" {
  class Campground <<type>>
  class Reservation <<type>>
  class User <<type>>
  class FilterOptions <<type>>
  class FormState <<type>>
}

' ============================================================================
' ê´€ê³„
' ============================================================================

' Hook â†’ React Dependencies
useCampgrounds --> ReactHooks : uses
useReservations --> ReactHooks : uses
useAuth --> ReactHooks : uses
useForm --> ReactHooks : uses
useFilteredData --> ReactHooks : uses
useLocalStorage --> ReactHooks : uses

' Hook â†’ Service Dependencies
useCampgrounds --> CampgroundService : uses
useReservations --> ReservationService : uses
useAuth --> UserService : uses
useForm --> ValidationUtils : uses

' Hook â†’ Storage Dependencies
useLocalStorage --> localStorage : read/write

' Hook â†’ Type Dependencies
useCampgrounds --> Campground : returns
useReservations --> Reservation : returns
useAuth --> User : returns
useForm --> FormState : manages
useFilteredData --> FilterOptions : uses

' ============================================================================
' ë ˆì´ì•„ì›ƒ
' ============================================================================
ReactHooks -[hidden]down- useCampgrounds
useCampgrounds -[hidden]down- useReservations
useReservations -[hidden]down- useAuth
useAuth -[hidden]down- useForm
useForm -[hidden]down- useFilteredData
useFilteredData -[hidden]down- useLocalStorage

CampgroundService -[hidden]down- ReservationService
ReservationService -[hidden]down- UserService
UserService -[hidden]down- ValidationUtils

legend right
  **Level 4: Code - Custom Hooks**

  **íŒŒì¼**: src/hooks/index.ts
  **íŒ¨í„´**: React Custom Hooks
  **ì˜ì¡´ì„±**: React, Services, Utils

  **í›… ë¶„ë¥˜**:

  **1. ë°ì´í„° ê´€ë¦¬ í›…**:
  - useCampgrounds: ìº í•‘ì¥ CRUD
  - useReservations: ì˜ˆì•½ CRUD
  - useAuth: ì‚¬ìš©ì ì¸ì¦

  **2. ìœ í‹¸ë¦¬í‹° í›…**:
  - useForm<T>: ì œë„¤ë¦­ í¼ ê´€ë¦¬
  - useFilteredData<T>: ì œë„¤ë¦­ í•„í„°ë§/ê²€ìƒ‰
  - useLocalStorage<T>: ì œë„¤ë¦­ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë™ê¸°í™”

  **ê³µí†µ íŒ¨í„´**:
  - useState: ìƒíƒœ ê´€ë¦¬
  - useEffect: ì‚¬ì´ë“œ ì´í™íŠ¸ (ì´ˆê¸° ë¡œë“œ)
  - useCallback: ë©”ëª¨ì´ì œì´ì…˜ (ì„±ëŠ¥ ìµœì í™”)
  - ì—ëŸ¬ ì²˜ë¦¬: try-catch + error ìƒíƒœ

  **ì œë„¤ë¦­ í›…ì˜ ì´ì **:
  - íƒ€ì… ì•ˆì „ì„±
  - ì¬ì‚¬ìš©ì„±
  - ìœ ì—°ì„±

  **ì‚¬ìš© ì˜ˆì‹œ**:
  ```typescript
  // ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
  function CampgroundList() {
    const {
      campgrounds,
      isLoading,
      error,
      addCampground
    } = useCampgrounds()

    const {
      filteredData,
      updateFilter
    } = useFilteredData(
      campgrounds,
      (item, filters) =>
        !filters.search ||
        item.name.includes(filters.search)
    )

    // ... render
  }
  ```
end legend

@enduml
