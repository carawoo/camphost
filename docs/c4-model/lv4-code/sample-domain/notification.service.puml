@startuml
' ==============================================================================
' [Level 4] NotificationService - Class Diagram
' ==============================================================================
' Package: @pioncorp/sample-domain
' Description: ë©€í‹°ì±„ë„ ì•Œë¦¼ ë°œì†¡ ì„œë¹„ìŠ¤ (Strategy Pattern)
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ:
'    â€¢ packages/sample-domain/src/notification/notification.service.ts
'    â€¢ packages/sample-domain/src/notification/notification.types.ts
'
' ğŸ”„ ë™ê¸°í™” ê·œì¹™:
'    âœ… ì´ íŒŒì¼ ë³€ê²½ â†’ lv3 (sample-domain.puml) "Notification Management" í™•ì¸
'    âœ… NotificationService í´ë˜ìŠ¤ ë³€ê²½ ì‹œ ì´ ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸ í•„ìˆ˜
'    âœ… ìƒˆë¡œìš´ Provider ì¶”ê°€ ì‹œ notification-providers.pumlë„ ì—…ë°ì´íŠ¸
'
' ğŸ“ ë³€ê²½ ëŒ€ìƒ:
'    â€¢ NotificationService í´ë˜ìŠ¤ (í•„ë“œ, ë©”ì„œë“œ)
'    â€¢ send*() ë©”ì„œë“œ (sendEmail, sendSms, sendPush, sendKakao)
'    â€¢ Provider í•„ë“œ (*Provider)
'    â€¢ ì¹´ìš´í„° í•„ë“œ (*Count)
'
' ğŸ” ê´€ë ¨ ë‹¤ì´ì–´ê·¸ë¨:
'    â€¢ notification-providers.puml (Provider ì¸í„°í˜ì´ìŠ¤/êµ¬í˜„)
'
' â¬†ï¸  Zoom Out: ../../lv3-components/sample-domain.puml
' ==============================================================================

skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam packageStyle rectangle
skinparam shadowing false
skinparam backgroundColor transparent

package "sample-domain" <<Rectangle>> #85BBF0 {

    class NotificationService <<singleton>> <<injectable>> {
        - logger: Logger
        - emailProvider: ConsoleEmailProvider
        - smsProvider: ConsoleSmsProvider
        - pushProvider: ConsolePushProvider
        - kakaoProvider: ConsoleKakaoProvider
        - emailCount: number
        - smsCount: number
        - pushCount: number
        - kakaoCount: number
        __constructor__
        + NotificationService(
            emailProvider: ConsoleEmailProvider,
            smsProvider: ConsoleSmsProvider,
            pushProvider: ConsolePushProvider,
            kakaoProvider: ConsoleKakaoProvider,
            logger: Logger
        )
        __email__
        + sendEmail(params: SendEmailParams): Promise<SendEmailResult>
        __sms__
        + sendSms(params: SendSmsParams): Promise<SendSmsResult>
        __push__
        + sendPush(params: SendPushParams): Promise<SendPushResult>
        __kakao__
        + sendKakao(params: SendKakaoParams): Promise<SendKakaoResult>
        __statistics__
        + getNotificationCount(): NotificationCount
        + resetNotificationCount(): void
    }

    ' --- Provider Interfaces ---

    interface EmailProvider {
        + send(params: SendEmailParams): Promise<SendEmailResult>
    }

    interface SmsProvider {
        + send(params: SendSmsParams): Promise<SendSmsResult>
    }

    interface PushProvider {
        + send(params: SendPushParams): Promise<SendPushResult>
    }

    interface KakaoProvider {
        + send(params: SendKakaoParams): Promise<SendKakaoResult>
    }

    ' --- Console Provider Implementations ---

    class ConsoleEmailProvider <<injectable>> {
        + send(params: SendEmailParams): Promise<SendEmailResult>
    }

    class ConsoleSmsProvider <<injectable>> {
        + send(params: SendSmsParams): Promise<SendSmsResult>
    }

    class ConsolePushProvider <<injectable>> {
        + send(params: SendPushParams): Promise<SendPushResult>
    }

    class ConsoleKakaoProvider <<injectable>> {
        + send(params: SendKakaoParams): Promise<SendKakaoResult>
    }

    ' --- Parameter Types ---

    class SendEmailParams <<interface>> {
        + to: string
        + subject: string
        + body: string
    }

    class SendSmsParams <<interface>> {
        + to: string
        + message: string
    }

    class SendPushParams <<interface>> {
        + deviceToken: string
        + title: string
        + body: string
        + data?: Record<string, unknown>
    }

    class SendKakaoParams <<interface>> {
        + to: string
        + templateCode: string
        + message: string
        + variables?: Record<string, string>
    }

    ' --- Result Types ---

    class SendEmailResult <<interface>> {
        + success: boolean
        + messageId?: string
        + error?: string
    }

    class SendSmsResult <<interface>> {
        + success: boolean
        + messageId?: string
        + error?: string
    }

    class SendPushResult <<interface>> {
        + success: boolean
        + messageId?: string
        + error?: string
    }

    class SendKakaoResult <<interface>> {
        + success: boolean
        + messageId?: string
        + error?: string
    }

    class NotificationCount <<interface>> {
        + email: number
        + sms: number
        + push: number
        + kakao: number
    }
}

' ==============================================================================
' Package: shared-core
' ==============================================================================

package "shared-core" <<Rectangle>> #85BBF0 {
    class Logger {
        + info(message: string, context?: object): void
        + error(message: string, context?: object): void
        + child(prefix: string): Logger
    }
}

' ==============================================================================
' Relationships - Strategy Pattern
' ==============================================================================

NotificationService -right-> Logger : <<uses>>

' Provider Dependencies (Constructor Injection)
NotificationService -down-> ConsoleEmailProvider : <<uses>>
NotificationService -down-> ConsoleSmsProvider : <<uses>>
NotificationService -down-> ConsolePushProvider : <<uses>>
NotificationService -down-> ConsoleKakaoProvider : <<uses>>

' Interface Implementation (FIX: use "..|>" not ".|>")
ConsoleEmailProvider ..|> EmailProvider : <<implements>>
ConsoleSmsProvider ..|> SmsProvider : <<implements>>
ConsolePushProvider ..|> PushProvider : <<implements>>
ConsoleKakaoProvider ..|> KakaoProvider : <<implements>>

' Method Parameters
NotificationService ..> SendEmailParams : <<accepts>>
NotificationService ..> SendSmsParams : <<accepts>>
NotificationService ..> SendPushParams : <<accepts>>
NotificationService ..> SendKakaoParams : <<accepts>>

' Method Returns
NotificationService ..> SendEmailResult : <<returns>>
NotificationService ..> SendSmsResult : <<returns>>
NotificationService ..> SendPushResult : <<returns>>
NotificationService ..> SendKakaoResult : <<returns>>
NotificationService ..> NotificationCount : <<returns>>

' Provider Methods
ConsoleEmailProvider ..> SendEmailParams : <<accepts>>
ConsoleEmailProvider ..> SendEmailResult : <<returns>>
ConsoleSmsProvider ..> SendSmsParams : <<accepts>>
ConsoleSmsProvider ..> SendSmsResult : <<returns>>
ConsolePushProvider ..> SendPushParams : <<accepts>>
ConsolePushProvider ..> SendPushResult : <<returns>>
ConsoleKakaoProvider ..> SendKakaoParams : <<accepts>>
ConsoleKakaoProvider ..> SendKakaoResult : <<returns>>

' ==============================================================================
' Notes
' ==============================================================================

note right of NotificationService #FFFFCC
  <b><size:14>Strategy Pattern</size></b>
  ---
  â€¢ Provider ì¸í„°í˜ì´ìŠ¤ë¡œ ì•Œë¦¼ ì±„ë„ ì¶”ìƒí™”
  â€¢ ìƒì„±ì ì£¼ì…ìœ¼ë¡œ êµ¬í˜„ì²´ êµì²´ ê°€ëŠ¥
  â€¢ Console â†’ AWS/Twilio/FCM ì‰½ê²Œ ì „í™˜

  <b><size:14>Validation</size></b>
  ---
  â€¢ Email: to, subject, body + @ í˜•ì‹
  â€¢ SMS: to, message + phone ì •ê·œì‹
  â€¢ Push: deviceToken, title, body
  â€¢ Kakao: to, templateCode, message + phone ì •ê·œì‹

  <b><size:14>Error Handling</size></b>
  ---
  â€¢ ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨ â†’ {success: false, error}
  â€¢ Provider ì˜ˆì™¸ â†’ try-catch â†’ Result ë°˜í™˜
  â€¢ ì ˆëŒ€ throw í•˜ì§€ ì•ŠìŒ
end note

note as ValidationDetails #FFFFCC
  <b><size:16>ì…ë ¥ ê²€ì¦ ê·œì¹™</size></b>
  ====
  <b>sendEmail()</b>
  1. Required: to, subject, body
  2. Format: to.includes('@')

  <b>sendSms()</b>
  1. Required: to, message
  2. Format: /^[0-9+\-() ]+$/.test(to)

  <b>sendPush()</b>
  1. Required: deviceToken, title, body
  2. deviceTokenì€ ë¬¸ìì—´ë§Œ ê²€ì¦

  <b>sendKakao()</b>
  1. Required: to, templateCode, message
  2. Format: /^[0-9+\-() ]+$/.test(to)
end note

ValidationDetails .up. NotificationService

note as CounterBehavior #FFFFCC
  <b><size:16>ì¹´ìš´í„° ë™ì‘</size></b>
  ====
  â€¢ ê° send*() ì„±ê³µ ì‹œ ì¹´ìš´í„° ì¦ê°€
  â€¢ getNotificationCount()ë¡œ ì¡°íšŒ
  â€¢ resetNotificationCount()ë¡œ ì´ˆê¸°í™”
  â€¢ í…ŒìŠ¤íŠ¸ ê²€ì¦ ë° ëª¨ë‹ˆí„°ë§ ìš©ë„
end note

CounterBehavior .down. NotificationService

' ==============================================================================
' DI Container
' ==============================================================================

class "DI Container\n(tsyringe)" as DIContainer <<singleton registry>> #85BBF0 {
  + resolve<T>(token: string): T
  + register<T>(token: string, provider: Provider<T>): void
}

DIContainer -down-> NotificationService : <<provides>>
DIContainer -down-> ConsoleEmailProvider : <<provides>>
DIContainer -down-> ConsoleSmsProvider : <<provides>>
DIContainer -down-> ConsolePushProvider : <<provides>>
DIContainer -down-> ConsoleKakaoProvider : <<provides>>
DIContainer -down-> Logger : <<provides>>

note left of DIContainer
  <b>Provider êµì²´</b>
  container.register(token,
    useClass: AwsSesEmailProvider)
end note

note as SyncGuide #FFE0E0
  <b>âš ï¸  ë™ê¸°í™” ì²´í¬ë¦¬ìŠ¤íŠ¸</b>
  ====
  ì´ ë‹¤ì´ì–´ê·¸ë¨ ë³€ê²½ ì‹œ:

  â˜ packages/sample-domain/src/notification/
     notification.service.ts ì½”ë“œ ë™ê¸°í™” í™•ì¸

  â˜ ìƒˆë¡œìš´ Provider ì¶”ê°€ ì‹œ (ì˜ˆ: Slack)
     â†’ sendSlack() ë©”ì„œë“œ ì¶”ê°€
     â†’ slackProvider í•„ë“œ ì¶”ê°€
     â†’ slackCount í•„ë“œ ì¶”ê°€
     â†’ notification-providers.puml ì—…ë°ì´íŠ¸
     â†’ lv3 (sample-domain.puml) ì—…ë°ì´íŠ¸
     â†’ lv2, lv1 ì™¸ë¶€ ì‹œìŠ¤í…œ í™•ì¸

  â˜ Provider ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ ì‹œ
     notification.types.ts í™•ì¸
end note

@enduml
