@startuml
' ==============================================================================
' [Level 4] UserService - Class Diagram
' ==============================================================================
' Package: @pioncorp/sample-domain
' Description: ì‚¬ìš©ì CRUD ê´€ë¦¬ ì„œë¹„ìŠ¤
'
' ğŸ”— ì½”ë“œ ê²½ë¡œ:
'    â€¢ packages/sample-domain/src/user/user.service.ts
'    â€¢ packages/sample-domain/src/user/user.types.ts
'
' ğŸ”„ ë™ê¸°í™” ê·œì¹™:
'    âœ… ì´ íŒŒì¼ ë³€ê²½ â†’ lv3 (sample-domain.puml) "User Management" í™•ì¸
'    âœ… UserService í´ë˜ìŠ¤ ë³€ê²½ ì‹œ ì´ ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸ í•„ìˆ˜
'
' ğŸ“ ë³€ê²½ ëŒ€ìƒ:
'    â€¢ UserService í´ë˜ìŠ¤ (í•„ë“œ, ë©”ì„œë“œ)
'    â€¢ User ì¸í„°í˜ì´ìŠ¤
'    â€¢ CreateUserInput DTO
'    â€¢ UpdateUserInput DTO
'
' â¬†ï¸  Zoom Out: ../../lv3-components/sample-domain.puml
' ==============================================================================

skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam packageStyle rectangle
skinparam shadowing false
skinparam backgroundColor transparent

package "sample-domain" <<Rectangle>> #85BBF0 {

    class UserService <<singleton>> <<injectable>> {
        - users: Map<string, User>
        - logger: Logger
        __constructor__
        + UserService(logger: Logger)
        __methods__
        + createUser(input: CreateUserInput): Promise<User>
        + getUserById(id: string): Promise<User | undefined>
        + getAllUsers(): Promise<User[]>
        + updateUser(id: string, input: UpdateUserInput): Promise<User | undefined>
        + deleteUser(id: string): Promise<boolean>
        __helpers__
        - isNameDuplicate(name: string, excludeUserId?: string): boolean
        __storage__
        .. In-Memory Map ..
    }

    class User <<interface>> {
        + id: string
        + name: string
        + email: string
        + createdAt: Date
    }

    class CreateUserInput <<interface>> {
        + name: string
        + email: string
    }

    class UpdateUserInput <<interface>> {
        + name?: string
        + email?: string
    }
}

package "shared-core" <<Rectangle>> #85BBF0 {
    class Logger {
        + info(message: string, context?: object): void
        + debug(message: string, context?: object): void
        + error(message: string, context?: object): void
        + child(prefix: string): Logger
    }
}

' ==============================================================================
' Relationships
' ==============================================================================

UserService -right-> Logger : <<uses>>
UserService .down.> User : <<creates>>
UserService .down.> User : <<manages>>
UserService .down.> CreateUserInput : <<accepts>>
UserService .down.> UpdateUserInput : <<accepts>>

' ==============================================================================
' Notes
' ==============================================================================

note right of UserService #FFFFCC
  <b><size:14>Decorators</size></b>
  ---
  â€¢ singleton - Application-wide singleton
  â€¢ injectable - DI container injectable

  <b><size:14>Storage</size></b>
  ---
  â€¢ Map<string, User> (In-Memory)
  â€¢ Key: UUID v4
  â€¢ No persistence (dev/test only)

  <b><size:14>Lifecycle</size></b>
  ---
  â€¢ Created once per application
  â€¢ Resolved via tsyringe container
  â€¢ Auto-registered by decorators
end note

note bottom of User #FFFFCC
  <b>UUID v4 ê¸°ë°˜ ID</b>
  createdAt: ìë™ ìƒì„± (new Date())

  ëŸ°íƒ€ì„ì— ìƒì„±ë˜ëŠ” ì—”í‹°í‹°
end note

note bottom of CreateUserInput #FFFFCC
  <b>DTO (Data Transfer Object)</b>

  í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ëŠ” ì…ë ¥ ë°ì´í„°
  ê²€ì¦ ë¡œì§ì€ ìƒìœ„ ê³„ì¸µ(API)ì—ì„œ ì²˜ë¦¬
end note

note bottom of UpdateUserInput #FFFFCC
  <b>DTO (Data Transfer Object)</b>

  ì‚¬ìš©ì ìˆ˜ì •ìš© ì…ë ¥ ë°ì´í„°
  ëª¨ë“  í•„ë“œê°€ ì˜µì…”ë„ (ë¶€ë¶„ ì—…ë°ì´íŠ¸)
end note

note as MethodDetails #FFFFCC
  <b><size:16>ë©”ì„œë“œ ìƒì„¸</size></b>
  ====
  <b>createUser()</b>
  â€¢ ì´ë¦„ ì¤‘ë³µ ê²€ì‚¬ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
  â€¢ ì¤‘ë³µ ì‹œ Error throw
  â€¢ UUID ìë™ ìƒì„±
  â€¢ createdAt ìë™ ì„¤ì •
  â€¢ Mapì— ì €ì¥
  â€¢ Logger ê¸°ë¡ (info)

  <b>getUserById()</b>
  â€¢ Map.get() ì¡°íšŒ
  â€¢ ì¡´ì¬ ì‹œ Logger ê¸°ë¡ (debug)
  â€¢ ì—†ìœ¼ë©´ undefined ë°˜í™˜

  <b>getAllUsers()</b>
  â€¢ Map.values() â†’ Array ë³€í™˜
  â€¢ Logger ê¸°ë¡ (info, count)

  <b>updateUser()</b>
  â€¢ ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
  â€¢ ì—†ìœ¼ë©´ undefined ë°˜í™˜
  â€¢ name ë³€ê²½ ì‹œ ì¤‘ë³µ ê²€ì‚¬ (ìì‹  ì œì™¸)
  â€¢ ì¤‘ë³µ ì‹œ Error throw
  â€¢ ì œê³µëœ í•„ë“œë§Œ ë¶€ë¶„ ì—…ë°ì´íŠ¸
  â€¢ Logger ê¸°ë¡ (info)
  â€¢ ìˆ˜ì •ëœ User ë°˜í™˜

  <b>deleteUser()</b>
  â€¢ Map.delete() í˜¸ì¶œ
  â€¢ ì„±ê³µ ì‹œ Logger ê¸°ë¡ (info)
  â€¢ boolean ë°˜í™˜ (true/false)

  <b>isNameDuplicate() [private]</b>
  â€¢ ì´ë¦„ ì¤‘ë³µ ì—¬ë¶€ ê²€ì‚¬ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
  â€¢ excludeUserIdë¡œ íŠ¹ì • ì‚¬ìš©ì ì œì™¸
  â€¢ boolean ë°˜í™˜
end note

MethodDetails .up. UserService

' ==============================================================================
' DI Container Relationship
' ==============================================================================

class "DI Container\n(tsyringe)" as DIContainer <<singleton registry>> #85BBF0 {
  + resolve<T>(token: string): T
  + register<T>(token: string, provider: Provider<T>): void
}

DIContainer -down-> UserService : <<provides>>
DIContainer -down-> Logger : <<provides>>

note right of DIContainer
  <b>ìë™ ë“±ë¡</b>
  reflect-metadata + decorators

  <b>í•´ì†Œ ë°©ë²•</b>
  container.resolve(UserService)
end note

note as SyncGuide #FFE0E0
  <b>âš ï¸  ë™ê¸°í™” ì²´í¬ë¦¬ìŠ¤íŠ¸</b>
  ====
  ì´ ë‹¤ì´ì–´ê·¸ë¨ ë³€ê²½ ì‹œ:

  â˜ packages/sample-domain/src/user/
     user.service.ts ì½”ë“œ ë™ê¸°í™” í™•ì¸

  â˜ ìƒˆë¡œìš´ ë©”ì„œë“œ ì¶”ê°€ ì‹œ
     lv3 (sample-domain.puml) "User Management"
     ì„¤ëª… ì—…ë°ì´íŠ¸

  â˜ User ì¸í„°í˜ì´ìŠ¤ í•„ë“œ ë³€ê²½ ì‹œ
     user.types.ts í™•ì¸
end note

@enduml
